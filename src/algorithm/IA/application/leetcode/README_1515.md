# LeetCode 1515: 服务中心的最佳位置

## 问题描述

一家快递公司希望在新城市建立新的服务中心。公司统计了该城市所有客户在二维地图上的坐标，并希望能够以此为依据为新的服务中心选址：**使服务中心到所有客户的欧几里得距离的总和最小**。

**输入**: 一个数组 `positions`，其中 `positions[i] = [xi, yi]` 表示第 i 个客户在二维地图上的位置。

**输出**: 到所有客户的欧几里得距离的最小总和，误差在 10^-5 以内的答案将被视作正确答案。

**目标函数**:
```
min Σ(i=0,n-1) √[(xc-xi)² + (yc-yi)²]
```

## 数学分析

这是一个**非凸优化问题**，没有简单的解析解。主要挑战包括：

1. **目标函数非线性**: 欧几里得距离包含平方根
2. **可能存在多个局部最优解**: 需要避免陷入局部最优
3. **精度要求高**: 需要达到 10^-5 的精度

## 算法实现

本实现提供了四种不同的数值优化方法，每种方法都有其优缺点：

### 1. 网格搜索法 (Grid Search)

#### 算法思想
在坐标平面上进行均匀网格化搜索，计算每个网格点的总距离，选择最小值。

#### 实现细节
- 首先确定所有客户坐标的边界范围
- 适当扩展边界以避免最优解在边界上
- 在扩展范围内创建均匀网格（默认 200×200）
- 计算每个网格点的总距离

#### 优缺点
**优点**:
- 实现简单，容易理解
- 一定能找到全局最优解（在网格精度内）
- 对初始点不敏感

**缺点**:
- 时间复杂度 O(grid_size² × n)
- 当客户数量多或坐标范围大时效率低下
- 网格精度受限

#### 时间复杂度
O(grid_size² × n)，其中 n 为客户数量

### 2. 梯度下降法 (Gradient Descent)

#### 算法思想
使用梯度信息沿着目标函数下降最快的方向进行迭代优化。

#### 数学基础
目标函数的梯度：
```
∂f/∂x = Σ(xi - x) / √[(xi-x)² + (yi-y)²]
∂f/∂y = Σ(yi - y) / √[(xi-x)² + (yi-y)²]
```

#### 实现细节
- **初始点选择**: 使用几何质心作为起点
- **学习率**: 初始 0.1，支持自适应调整
- **收敛条件**: 连续两次迭代的距离差小于 10^-7
- **最大迭代次数**: 10,000 次

#### 优化技巧
- **自适应学习率**: 当距离增加时自动减小学习率
- **避免除零**: 当距离接近 0 时，梯度设为 0
- **早期停止**: 达到收敛条件时提前终止

#### 优缺点
**优点**:
- 收敛速度快，通常在数百次迭代内收敛
- 对大规模问题效率高
- 精度可控

**缺点**:
- 可能陷入局部最优
- 对初始点敏感
- 需要计算梯度

### 3. 随机搜索法 (Random Search)

#### 算法思想
多次随机选择起点进行局部优化，选择最好的结果。

#### 实现细节
- **随机起点数量**: 默认 20 个
- **起点生成**: 在客户坐标范围内随机选择
- **局部优化**: 每个起点进行最多 1000 次梯度下降
- **学习率衰减**: 使用指数衰减策略

#### 优缺点
**优点**:
- 能有效避免局部最优
- 实现相对简单
- 对初始点不敏感

**缺点**:
- 计算量较大（需要多次优化）
- 结果可能有随机性
- 参数选择影响结果

### 4. 质心优化法 (Centroid Optimization)

#### 算法思想
从几何质心开始，使用坐标下降法（交替优化 x 和 y 坐标）进行优化。

#### 实现细节
- **初始点**: 计算所有客户的几何平均值
- **坐标下降**: 交替优化 x 和 y 方向
- **步长策略**: 固定步长 0.01，支持自适应减小
- **收敛条件**: 没有改进时减小步长至 10^-8

#### 几何直觉
质心通常是距离总和最小化的良好初始近似，因为：
- 对于均匀分布的点，质心就是最优解
- 对于一般分布，质心提供了很好的搜索起点

#### 优缺点
**优点**:
- 几何意义清晰
- 对参数不敏感
- 实现简单

**缺点**:
- 收敛速度较慢
- 可能在某些情况下效率不高

## 综合方法

主方法 `getMinDistSum` 根据问题规模自动选择最合适的算法：

- **小规模问题** (n ≤ 10): 使用网格搜索，确保精度
- **大规模问题** (n > 10): 组合使用三种优化方法，取最优结果

## 性能分析

| 方法 | 时间复杂度 | 空间复杂度 | 适用场景 |
|------|-----------|-----------|---------|
| 网格搜索 | O(grid² × n) | O(1) | 小规模问题 |
| 梯度下降 | O(iter × n) | O(1) | 一般问题 |
| 随机搜索 | O(random_starts × iter × n) | O(1) | 非凸问题 |
| 质心优化 | O(iter × n) | O(1) | 需要几何直觉 |

## 数值稳定性考虑

1. **除零保护**: 在计算梯度时避免距离为 0 的情况
2. **数值精度**: 使用 double 类型确保计算精度
3. **收敛检测**: 使用相对误差而不是绝对误差
4. **学习率控制**: 防止学习率过大导致发散

## 测试建议

建议使用以下测试用例验证算法正确性：

1. **单点测试**: positions = [[0,0]]，期望结果：0.0
2. **两点测试**: positions = [[0,0],[1,1]]，期望结果：√2
3. **对称分布**: positions = [[-1,0],[1,0],[0,1],[0,-1]]，期望结果接近 0
4. **边界情况**: 大量点集中在一点附近

## 扩展思考

1. **三维扩展**: 可以推广到三维空间，但计算复杂度会显著增加
2. **加权距离**: 如果不同客户有不同重要性，可以引入权重
3. **曼哈顿距离**: 如果使用曼哈顿距离而不是欧几里得距离，问题变为凸优化，有解析解
4. **约束优化**: 如果服务中心位置有约束条件，需要使用约束优化方法

## 参考文献

1. Weiszfeld, E. (1937). "Sur le point pour lequel la somme des distances de n points donnés est minimum"
2. Kuhn, H. W. (1973). "A note on Fermat's problem"
3. Love, R. F., Morris, J. G., & Wesolowsky, G. O. (1988). "Facilities location: models & methods"
